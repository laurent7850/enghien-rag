services:
  web:
    image: node:20-alpine
    container_name: enghien-web
    restart: unless-stopped
    working_dir: /app
    command: sh -c "node server.js"
    environment:
      - DATABASE_URL=postgresql://enghien:enghien_secret_2024@193.203.191.251:5433/enghien_rag
      - OPENROUTER_API_KEY=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
      - SITE_URL=https://enghien.srv767464.hstgr.cloud
      - NODE_ENV=production
      - PORT=3000
      - HOSTNAME=0.0.0.0
    networks:
      - root_default
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.enghien.rule=Host(`enghien.srv767464.hstgr.cloud`)"
      - "traefik.http.routers.enghien.entrypoints=websecure"
      - "traefik.http.routers.enghien.tls.certresolver=letsencrypt"
      - "traefik.http.services.enghien.loadbalancer.server.port=3000"
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3000/enghien"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  root_default:
    external: true
